#!/bin/sh

set -e

home=$(dirname $0)/..
home=$(cd $home && env - pwd)

main=$1
src=$2
shift 2

obj=${src%.c}.o
[[ -e $obj && $src -nt $obj ]] && rm -f $obj || :
[[ -e $obj ]] || $home/bin/compile $src

crt=
grep -q '^main(' $src && crt=$HOME/lib/crt0.o

$home/bin/cc -o $main $crt $obj "$@"
sstrip -z $main
