#!/bin/sh
set -e
home=$(realpath "$0")
home=${home%/*/*}
cd $home
main=$1
shift
file=$(print -r -- $main.[Scs])
if [[ -e $main.o && $file -nt $main.o ]]
then
	rm -f $main.o
fi
case $file in
($main.S)
	[[ -e $main.o ]] || bin/assemble-nasm $file
	;;
($main.c)
	[[ -e $main.o ]] || bin/compile $file
	;;
($main.s)
	[[ -e $main.o ]] || bin/assemble $file
	;;
esac
if [[ -e $main.o ]]
then
	[[ -e lib/crt0.o ]] || lib/bin/assemble crt0.s
	tcc -nostdinc -nostdlib -L$HOME/lib -static -o $main lib/crt0.o $main.o "$@"
fi
